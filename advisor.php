<?php
ini_set('display errors	', true);
if(!define('sugarEntry')) define('sugarEntry', true);
require_once('include/entryPoint.php');


global $db;
/*
$lquery = "SELECT DISTINCT u.id AS id, u.user_name as user_name
FROM acl_roles ar
JOIN acl_roles_users aru ON aru.role_id = ar.id AND aru.deleted=0
JOIN users u ON u.id = aru.user_id
WHERE ar.deleted =0
AND ar.id =  'ca231870-f409-b054-bba2-585780223097'
AND u.deleted =0";
*/
$today = gmdate('Y-m-d');
$lquery = "SELECT DISTINCT u.id AS id, u.user_name as user_name
FROM acl_roles ar
JOIN acl_roles_users aru ON aru.role_id = ar.id AND aru.deleted=0
JOIN users u ON u.id = aru.user_id
WHERE ar.deleted =0
AND ar.id =  'a8ab8653-5860-d896-7a78-58466a429bee'
AND u.deleted =0 AND date(u.date_entered)='$today'";
//~ $lquery = "SELECT DISTINCT u.id AS id, u.user_name as user_name
//~ FROM acl_roles ar
//~ JOIN acl_roles_users aru ON aru.role_id = ar.id AND aru.deleted=0
//~ JOIN users u ON u.id = aru.user_id
//~ WHERE ar.deleted =0
//~ AND ar.id =  '255c657f-6c02-c252-ebf6-585782eabadf'
//~ AND u.deleted =0 and u.user_name!='Poorti'";
$i = 1;
$result1 = $db->query($lquery);
while($row1 = $db->fetchByAssoc($result1)){
	
	echo $rec_id = $row1['id']; 
//	echo $rec_id = 'ea4b9e97-9b0d-5d70-0f7d-587de6723949'; 
	
	echo  ' 	' . $row1['user_name'] . ' 		';
	
	echo '<br>';
	
	$up_query = "select count(id) as id from user_preferences where assigned_user_id = '$rec_id' and deleted = 0 and category = 'Home'";
	$up_result = $db->query($up_query);
	while($row = $db->fetchByAssoc($up_result)){
		
		$update_branch = "update user_preferences set deleted = '1' where category = 'Home' and deleted = 0 and assigned_user_id = '$rec_id'";
		
		$db->query($update_branch);
		
	}
	
		
		$id = create_guid();
		
	$query = "insert into user_preferences(id,category, deleted, date_entered, date_modified, assigned_user_id, contents) values('$id' , 'Home' , '0' , Now() , Now(), '$rec_id' , 'YToyOntzOjg6ImRhc2hsZXRzIjthOjM6e3M6MzY6ImQ4MGY4ODczLTNmZjctMDg1ZC1mYTkyLTU4NTNlOWE5OWYzNyI7YTo1OntzOjk6ImNsYXNzTmFtZSI7czoxNDoiTXlDYWxsc0Rhc2hsZXQiO3M6NjoibW9kdWxlIjtzOjU6IkNhbGxzIjtzOjExOiJmb3JjZUNvbHVtbiI7aTowO3M6MTI6ImZpbGVMb2NhdGlvbiI7czo1NjoibW9kdWxlcy9DYWxscy9EYXNobGV0cy9NeUNhbGxzRGFzaGxldC9NeUNhbGxzRGFzaGxldC5waHAiO3M6Nzoib3B0aW9ucyI7YTo2OntzOjc6ImZpbHRlcnMiO2E6Mzp7czo2OiJzdGF0dXMiO2E6MTp7aTowO3M6NzoiUGxhbm5lZCI7fXM6MTI6ImRhdGVfZW50ZXJlZCI7YTowOnt9czoxMDoiZGF0ZV9zdGFydCI7YToxOntzOjQ6InR5cGUiO3M6ODoiVFBfdG9kYXkiO319czo1OiJ0aXRsZSI7czoyNToiRm9sbG93LVVwIENhbGxzIGZvciBUb2RheSI7czoxMToibXlJdGVtc09ubHkiO3M6NDoidHJ1ZSI7czoxMToiZGlzcGxheVJvd3MiO3M6MToiNSI7czoxNDoiZGlzcGxheUNvbHVtbnMiO2E6Njp7aTowO3M6MTI6InNldF9jb21wbGV0ZSI7aToxO3M6NDoibmFtZSI7aToyO3M6MTE6InBhcmVudF9uYW1lIjtpOjM7czoxMDoiZGF0ZV9zdGFydCI7aTo0O3M6Njoic3RhdHVzIjtpOjU7czoxMzoiZGF0ZV9tb2RpZmllZCI7fXM6MTE6ImF1dG9SZWZyZXNoIjtzOjI6IjMwIjt9fXM6MzY6ImE2N2NkNjZiLTgxMWUtNDc0Mi03ZjI5LTU4NTdlMDgwZDZkNiI7YTo1OntzOjk6ImNsYXNzTmFtZSI7czoxNzoiTXlDb250YWN0c0Rhc2hsZXQiO3M6NjoibW9kdWxlIjtzOjg6IkNvbnRhY3RzIjtzOjc6Im9wdGlvbnMiO2E6Njp7czo3OiJmaWx0ZXJzIjthOjM6e3M6MTI6ImRhdGVfZW50ZXJlZCI7YTowOnt9czoyMjoidXNlcl9hbGxvY2F0aW9uX2RhdGVfYyI7YToxOntzOjQ6InR5cGUiO3M6ODoiVFBfdG9kYXkiO31zOjEzOiJkaXNwb3NpdGlvbl9jIjthOjE6e2k6MDtzOjA6IiI7fX1zOjU6InRpdGxlIjtzOjIwOiJUb2RheSBBc3NpZ25lZCBVc2VycyI7czoxMToibXlJdGVtc09ubHkiO3M6NDoidHJ1ZSI7czoxMToiZGlzcGxheVJvd3MiO3M6MjoiMTAiO3M6MTQ6ImRpc3BsYXlDb2x1bW5zIjthOjU6e2k6MDtzOjQ6Im5hbWUiO2k6MTtzOjEyOiJwaG9uZV9tb2JpbGUiO2k6MjtzOjY6ImVtYWlsMSI7aTozO3M6OToiZ2F0ZXdheV9jIjtpOjQ7czoxMjoiZGF0ZV9lbnRlcmVkIjt9czoxMToiYXV0b1JlZnJlc2giO3M6MjoiMzAiO31zOjEyOiJmaWxlTG9jYXRpb24iO3M6NjU6Im1vZHVsZXMvQ29udGFjdHMvRGFzaGxldHMvTXlDb250YWN0c0Rhc2hsZXQvTXlDb250YWN0c0Rhc2hsZXQucGhwIjtzOjEyOiJzb3J0X29wdGlvbnMiO2E6Mjp7czo5OiJzb3J0T3JkZXIiO3M6NDoiZGVzYyI7czo3OiJvcmRlckJ5IjtzOjIyOiJ1c2VyX2FsbG9jYXRpb25fZGF0ZV9jIjt9fXM6MzY6ImQ0NjJlYzdlLTQ1ODYtZTkwNi0wZTM2LTU4NThlMTVjMGExMSI7YTo0OntzOjk6ImNsYXNzTmFtZSI7czoxNzoiTXlDb250YWN0c0Rhc2hsZXQiO3M6NjoibW9kdWxlIjtzOjg6IkNvbnRhY3RzIjtzOjc6Im9wdGlvbnMiO2E6Njp7czo3OiJmaWx0ZXJzIjthOjM6e3M6MTI6ImRhdGVfZW50ZXJlZCI7YTowOnt9czoyMjoidXNlcl9hbGxvY2F0aW9uX2RhdGVfYyI7YTowOnt9czoyNDoib25saW5lX2FjdGl2aXR5X3N0YXR1c19jIjthOjE6e2k6MDtzOjY6IkFjdGl2ZSI7fX1zOjU6InRpdGxlIjtzOjE1OiJNeSBPbmxpbmUgVXNlcnMiO3M6MTE6Im15SXRlbXNPbmx5IjtzOjQ6InRydWUiO3M6MTE6ImRpc3BsYXlSb3dzIjtzOjE6IjUiO3M6MTQ6ImRpc3BsYXlDb2x1bW5zIjthOjY6e2k6MDtzOjQ6Im5hbWUiO2k6MTtzOjEyOiJwaG9uZV9tb2JpbGUiO2k6MjtzOjY6ImVtYWlsMSI7aTozO3M6MTM6InNhbGVzX3N0YWdlX2MiO2k6NDtzOjE4OiJhc3NpZ25lZF91c2VyX25hbWUiO2k6NTtzOjIyOiJ1c2VyX2FsbG9jYXRpb25fZGF0ZV9jIjt9czoxMToiYXV0b1JlZnJlc2giO3M6MjoiMzAiO31zOjEyOiJmaWxlTG9jYXRpb24iO3M6NjU6Im1vZHVsZXMvQ29udGFjdHMvRGFzaGxldHMvTXlDb250YWN0c0Rhc2hsZXQvTXlDb250YWN0c0Rhc2hsZXQucGhwIjt9fXM6NToicGFnZXMiO2E6MTp7aTowO2E6Mzp7czo3OiJjb2x1bW5zIjthOjI6e2k6MDthOjI6e3M6NToid2lkdGgiO3M6MzoiNjAlIjtzOjg6ImRhc2hsZXRzIjthOjI6e2k6MztzOjM2OiJhNjdjZDY2Yi04MTFlLTQ3NDItN2YyOS01ODU3ZTA4MGQ2ZDYiO2k6NDtzOjM2OiJkNDYyZWM3ZS00NTg2LWU5MDYtMGUzNi01ODU4ZTE1YzBhMTEiO319aToxO2E6Mjp7czo1OiJ3aWR0aCI7czozOiI0MCUiO3M6ODoiZGFzaGxldHMiO2E6MTp7aTowO3M6MzY6ImQ4MGY4ODczLTNmZjctMDg1ZC1mYTkyLTU4NTNlOWE5OWYzNyI7fX19czoxMDoibnVtQ29sdW1ucyI7czoxOiIzIjtzOjE0OiJwYWdlVGl0bGVMYWJlbCI7czoyMDoiTEJMX0hPTUVfUEFHRV8xX05BTUUiO319fQ==')";
		//$query = "insert into user_preferences(id,category, deleted, date_entered, date_modified, assigned_user_id, contents) values('$id' , 'Home' , '0' , Now() , Now(), '$rec_id' , 'YToyOntzOjg6ImRhc2hsZXRzIjthOjM6e3M6MzY6IjMwMTQ2Mjc2LTA0MGUtZDNhYi01ZGQ3LTU4NThkM2U5Njk4ZSI7YTo1OntzOjk6ImNsYXNzTmFtZSI7czoxNDoiTXlDYWxsc0Rhc2hsZXQiO3M6NjoibW9kdWxlIjtzOjU6IkNhbGxzIjtzOjExOiJmb3JjZUNvbHVtbiI7aTowO3M6MTI6ImZpbGVMb2NhdGlvbiI7czo1NjoibW9kdWxlcy9DYWxscy9EYXNobGV0cy9NeUNhbGxzRGFzaGxldC9NeUNhbGxzRGFzaGxldC5waHAiO3M6Nzoib3B0aW9ucyI7YTo2OntzOjc6ImZpbHRlcnMiO2E6Mzp7czo2OiJzdGF0dXMiO2E6MTp7aTowO3M6NzoiUGxhbm5lZCI7fXM6MTI6ImRhdGVfZW50ZXJlZCI7YTowOnt9czoxMDoiZGF0ZV9zdGFydCI7YToxOntzOjQ6InR5cGUiO3M6ODoiVFBfdG9kYXkiO319czo1OiJ0aXRsZSI7czozMDoiTXkgVGVhbSBDYWxscyBBc3NpZ25lZCAtIFRvZGF5IjtzOjExOiJteUl0ZW1zT25seSI7YjowO3M6MTE6ImRpc3BsYXlSb3dzIjtzOjE6IjUiO3M6MTQ6ImRpc3BsYXlDb2x1bW5zIjthOjY6e2k6MDtzOjEyOiJzZXRfY29tcGxldGUiO2k6MTtzOjQ6Im5hbWUiO2k6MjtzOjExOiJwYXJlbnRfbmFtZSI7aTozO3M6MTA6ImRhdGVfc3RhcnQiO2k6NDtzOjE2OiJzZXRfYWNjZXB0X2xpbmtzIjtpOjU7czo2OiJzdGF0dXMiO31zOjExOiJhdXRvUmVmcmVzaCI7czoyOiIzMCI7fX1zOjM2OiJhYmNmZWFmOS01NzBkLTJhNGQtZTA5YS01ODU4ZDMxNzRiNDgiO2E6NDp7czo5OiJjbGFzc05hbWUiO3M6MTc6Ik15Q29udGFjdHNEYXNobGV0IjtzOjY6Im1vZHVsZSI7czo4OiJDb250YWN0cyI7czo3OiJvcHRpb25zIjthOjY6e3M6NzoiZmlsdGVycyI7YTozOntzOjEyOiJkYXRlX2VudGVyZWQiO2E6MDp7fXM6MjI6InVzZXJfYWxsb2NhdGlvbl9kYXRlX2MiO2E6MTp7czo0OiJ0eXBlIjtzOjg6IlRQX3RvZGF5Ijt9czoxMzoiZGlzcG9zaXRpb25fYyI7YToxOntpOjA7czowOiIiO319czo1OiJ0aXRsZSI7czozMDoiTXkgVGVhbSBVc2VycyBBc3NpZ25lZCAtIFRvZGF5IjtzOjExOiJteUl0ZW1zT25seSI7YjowO3M6MTE6ImRpc3BsYXlSb3dzIjtzOjE6IjUiO3M6MTQ6ImRpc3BsYXlDb2x1bW5zIjthOjY6e2k6MDtzOjQ6Im5hbWUiO2k6MTtzOjEyOiJwaG9uZV9tb2JpbGUiO2k6MjtzOjY6ImVtYWlsMSI7aTozO3M6MTM6InNhbGVzX3N0YWdlX2MiO2k6NDtzOjE4OiJhc3NpZ25lZF91c2VyX25hbWUiO2k6NTtzOjIyOiJ1c2VyX2FsbG9jYXRpb25fZGF0ZV9jIjt9czoxMToiYXV0b1JlZnJlc2giO3M6MjoiMzAiO31zOjEyOiJmaWxlTG9jYXRpb24iO3M6NjU6Im1vZHVsZXMvQ29udGFjdHMvRGFzaGxldHMvTXlDb250YWN0c0Rhc2hsZXQvTXlDb250YWN0c0Rhc2hsZXQucGhwIjt9czozNjoiYjY2Njg4NDEtNTkxZi04YTJkLWQ3YzYtNTg1OGYxZjgxY2U4IjthOjQ6e3M6OToiY2xhc3NOYW1lIjtzOjE3OiJNeUNvbnRhY3RzRGFzaGxldCI7czo2OiJtb2R1bGUiO3M6ODoiQ29udGFjdHMiO3M6Nzoib3B0aW9ucyI7YTo2OntzOjc6ImZpbHRlcnMiO2E6Mzp7czoxMjoiZGF0ZV9lbnRlcmVkIjthOjA6e31zOjIyOiJ1c2VyX2FsbG9jYXRpb25fZGF0ZV9jIjthOjA6e31zOjI0OiJvbmxpbmVfYWN0aXZpdHlfc3RhdHVzX2MiO2E6MTp7aTowO3M6NjoiQWN0aXZlIjt9fXM6NToidGl0bGUiO3M6MjA6Ik15IFRlYW0gQWN0aXZlIFVzZXJzIjtzOjExOiJteUl0ZW1zT25seSI7YjowO3M6MTE6ImRpc3BsYXlSb3dzIjtzOjE6IjUiO3M6MTQ6ImRpc3BsYXlDb2x1bW5zIjthOjY6e2k6MDtzOjQ6Im5hbWUiO2k6MTtzOjEyOiJwaG9uZV9tb2JpbGUiO2k6MjtzOjY6ImVtYWlsMSI7aTozO3M6MTM6InNhbGVzX3N0YWdlX2MiO2k6NDtzOjE4OiJhc3NpZ25lZF91c2VyX25hbWUiO2k6NTtzOjIyOiJ1c2VyX2FsbG9jYXRpb25fZGF0ZV9jIjt9czoxMToiYXV0b1JlZnJlc2giO3M6MjoiMzAiO31zOjEyOiJmaWxlTG9jYXRpb24iO3M6NjU6Im1vZHVsZXMvQ29udGFjdHMvRGFzaGxldHMvTXlDb250YWN0c0Rhc2hsZXQvTXlDb250YWN0c0Rhc2hsZXQucGhwIjt9fXM6NToicGFnZXMiO2E6MTp7aTowO2E6Mzp7czo3OiJjb2x1bW5zIjthOjI6e2k6MDthOjI6e3M6NToid2lkdGgiO3M6MzoiNjAlIjtzOjg6ImRhc2hsZXRzIjthOjI6e2k6MDtzOjM2OiJhYmNmZWFmOS01NzBkLTJhNGQtZTA5YS01ODU4ZDMxNzRiNDgiO2k6MTtzOjM2OiJiNjY2ODg0MS01OTFmLThhMmQtZDdjNi01ODU4ZjFmODFjZTgiO319aToxO2E6Mjp7czo1OiJ3aWR0aCI7czozOiI0MCUiO3M6ODoiZGFzaGxldHMiO2E6MTp7aTowO3M6MzY6IjMwMTQ2Mjc2LTA0MGUtZDNhYi01ZGQ3LTU4NThkM2U5Njk4ZSI7fX19czoxMDoibnVtQ29sdW1ucyI7czoxOiIzIjtzOjE0OiJwYWdlVGl0bGVMYWJlbCI7czoyMDoiTEJMX0hPTUVfUEFHRV8xX05BTUUiO319fQ==')";
		
		$result = $db->query($query);
	
		//exit;
}
